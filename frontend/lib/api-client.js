"use strict";
/**
 * API Client for Overlay Platform Backend
 * Base URL: https://wojz5amtrl.execute-api.eu-west-1.amazonaws.com/production
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.apiClient = void 0;
const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL || 'https://wojz5amtrl.execute-api.eu-west-1.amazonaws.com/production';
class ApiClient {
    baseUrl;
    token = null;
    constructor(baseUrl) {
        this.baseUrl = baseUrl;
        // Load token from localStorage if available
        if (typeof window !== 'undefined') {
            this.token = localStorage.getItem('auth_token');
        }
    }
    setToken(token) {
        this.token = token;
        if (typeof window !== 'undefined') {
            localStorage.setItem('auth_token', token);
        }
    }
    clearToken() {
        this.token = null;
        if (typeof window !== 'undefined') {
            localStorage.removeItem('auth_token');
        }
    }
    getToken() {
        return this.token;
    }
    async request(endpoint, options = {}) {
        const url = `${this.baseUrl}${endpoint}`;
        const headers = {
            'Content-Type': 'application/json',
        };
        if (this.token) {
            headers['Authorization'] = this.token;
        }
        if (options.headers) {
            Object.assign(headers, options.headers);
        }
        try {
            const response = await fetch(url, {
                ...options,
                headers,
            });
            const data = await response.json();
            return {
                data: response.ok ? data : undefined,
                error: response.ok ? undefined : (data.error || data.message || 'Request failed'),
                status: response.status,
            };
        }
        catch (error) {
            console.error('API request error:', error);
            return {
                error: error instanceof Error ? error.message : 'Network error',
                status: 0,
            };
        }
    }
    // Sessions endpoints
    async getSessions() {
        return this.request('/sessions');
    }
    async getAvailableSessions() {
        return this.request('/sessions/available');
    }
    async getSession(sessionId) {
        return this.request(`/sessions/${sessionId}`);
    }
    async getSessionSubmissions(sessionId) {
        return this.request(`/sessions/${sessionId}/submissions`);
    }
    async getSessionReport(sessionId) {
        return this.request(`/sessions/${sessionId}/report`);
    }
    async getSessionExport(sessionId) {
        return this.request(`/sessions/${sessionId}/export`);
    }
    async createSession(data) {
        return this.request('/sessions', {
            method: 'POST',
            body: JSON.stringify(data),
        });
    }
    async deleteSession(sessionId) {
        return this.request(`/sessions/${sessionId}`, {
            method: 'DELETE',
        });
    }
    async updateSession(sessionId, data) {
        return this.request(`/sessions/${sessionId}`, {
            method: 'PUT',
            body: JSON.stringify(data),
        });
    }
    // Submissions endpoints
    async getSubmissions() {
        return this.request('/submissions');
    }
    async getSubmission(submissionId) {
        return this.request(`/submissions/${submissionId}`);
    }
    async createSubmission(data) {
        return this.request('/submissions', {
            method: 'POST',
            body: JSON.stringify(data),
        });
    }
    async getSubmissionFeedback(submissionId) {
        return this.request(`/submissions/${submissionId}/feedback`);
    }
    async getSubmissionDownload(submissionId) {
        return this.request(`/submissions/${submissionId}/download`);
    }
    async downloadSubmissionFile(submissionId) {
        return this.request(`/submissions/${submissionId}/download-file`);
    }
    async downloadAppendix(submissionId, appendixOrder) {
        return this.request(`/submissions/${submissionId}/download-appendix/${appendixOrder}`);
    }
    // Answers endpoints
    async getAnswers(submissionId) {
        return this.request(`/submissions/${submissionId}/answers`);
    }
    async submitAnswer(submissionId, data) {
        return this.request(`/submissions/${submissionId}/answers`, {
            method: 'POST',
            body: JSON.stringify(data),
        });
    }
    // Organizations endpoints
    async getOrganizations() {
        return this.request('/organizations');
    }
    // Overlays endpoints
    async getOverlays() {
        return this.request('/overlays');
    }
    async getOverlay(overlayId) {
        return this.request(`/overlays/${overlayId}`);
    }
    async createOverlay(data) {
        return this.request('/overlays', {
            method: 'POST',
            body: JSON.stringify(data),
        });
    }
    async updateOverlay(overlayId, data) {
        return this.request(`/overlays/${overlayId}`, {
            method: 'PUT',
            body: JSON.stringify(data),
        });
    }
    async deleteOverlay(overlayId) {
        return this.request(`/overlays/${overlayId}`, {
            method: 'DELETE',
        });
    }
    // LLM Config endpoints (admin only)
    async getLLMConfigs() {
        return this.request('/llm-config');
    }
    async getLLMConfig(agentName) {
        return this.request(`/llm-config/${agentName}`);
    }
    async updateLLMConfig(agentName, data) {
        return this.request(`/llm-config/${agentName}`, {
            method: 'PUT',
            body: JSON.stringify(data),
        });
    }
}
exports.apiClient = new ApiClient(API_BASE_URL);
exports.default = exports.apiClient;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBpLWNsaWVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImFwaS1jbGllbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7O0FBRUgsTUFBTSxZQUFZLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsSUFBSSxtRUFBbUUsQ0FBQztBQVFqSSxNQUFNLFNBQVM7SUFDTCxPQUFPLENBQVM7SUFDaEIsS0FBSyxHQUFrQixJQUFJLENBQUM7SUFFcEMsWUFBWSxPQUFlO1FBQ3pCLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBQ3ZCLDRDQUE0QztRQUM1QyxJQUFJLE9BQU8sTUFBTSxLQUFLLFdBQVcsRUFBRSxDQUFDO1lBQ2xDLElBQUksQ0FBQyxLQUFLLEdBQUcsWUFBWSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUNsRCxDQUFDO0lBQ0gsQ0FBQztJQUVELFFBQVEsQ0FBQyxLQUFhO1FBQ3BCLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ25CLElBQUksT0FBTyxNQUFNLEtBQUssV0FBVyxFQUFFLENBQUM7WUFDbEMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDNUMsQ0FBQztJQUNILENBQUM7SUFFRCxVQUFVO1FBQ1IsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDbEIsSUFBSSxPQUFPLE1BQU0sS0FBSyxXQUFXLEVBQUUsQ0FBQztZQUNsQyxZQUFZLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ3hDLENBQUM7SUFDSCxDQUFDO0lBRUQsUUFBUTtRQUNOLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztJQUNwQixDQUFDO0lBRU8sS0FBSyxDQUFDLE9BQU8sQ0FDbkIsUUFBZ0IsRUFDaEIsVUFBdUIsRUFBRTtRQUV6QixNQUFNLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLEdBQUcsUUFBUSxFQUFF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SUFBSSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDO1NBQzNCLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxLQUFLLENBQUMsYUFBYSxDQUFDLFNBQWlCO1FBQ25DLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBTSxhQUFhLFNBQVMsRUFBRSxFQUFFO1lBQ2pELE1BQU0sRUFBRSxRQUFRO1NBQ2pCLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxvQ0FBb0M7SUFDcEMsS0FBSyxDQUFDLGFBQWE7UUFDakIsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFvQyxhQUFhLENBQUMsQ0FBQztJQUN4RSxDQUFDO0lBRUQsS0FBSyxDQUFDLFlBQVksQ0FBQyxTQUFpQjtRQUNsQyxPQUFPLElBQUksQ0FBQyxPQUFPLENBQU0sZUFBZSxTQUFTLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZELENBQUM7SUFFRCxLQUFLLENBQUMsZUFBZSxDQUFDLFNBQWlCLEVBQUUsSUFBUztRQUNoRCxPQUFPLElBQUksQ0FBQyxPQUFPLENBQU0sZUFBZSxTQUFTLEVBQUUsRUFBRTtZQUNuRCxNQUFNLEVBQUUsS0FBSztZQUNiLElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQztTQUMzQixDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0Y7QUFFWSxRQUFBLFNBQVMsR0FBRyxJQUFJLFNBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUNyRCxrQkFBZSxpQkFBUyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBUEkgQ2xpZW50IGZvciBPdmVybGF5IFBsYXRmb3JtIEJhY2tlbmRcbiAqIEJhc2UgVVJMOiBodHRwczovL3dvano1YW10cmwuZXhlY3V0ZS1hcGkuZXUtd2VzdC0xLmFtYXpvbmF3cy5jb20vcHJvZHVjdGlvblxuICovXG5cbmNvbnN0IEFQSV9CQVNFX1VSTCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0FQSV9CQVNFX1VSTCB8fCAnaHR0cHM6Ly93b2p6NWFtdHJsLmV4ZWN1dGUtYXBpLmV1LXdlc3QtMS5hbWF6b25hd3MuY29tL3Byb2R1Y3Rpb24nO1xuXG5pbnRlcmZhY2UgQXBpUmVzcG9uc2U8VD4ge1xuICBkYXRhPzogVDtcbiAgZXJyb3I/OiBzdHJpbmc7XG4gIHN0YXR1czogbnVtYmVyO1xufVxuXG5jbGFzcyBBcGlDbGllbnQge1xuICBwcml2YXRlIGJhc2VVcmw6IHN0cmluZztcbiAgcHJpdmF0ZSB0b2tlbjogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG5cbiAgY29uc3RydWN0b3IoYmFzZVVybDogc3RyaW5nKSB7XG4gICAgdGhpcy5iYXNlVXJsID0gYmFzZVVybDtcbiAgICAvLyBMb2FkIHRva2VuIGZyb20gbG9jYWxTdG9yYWdlIGlmIGF2YWlsYWJsZVxuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgdGhpcy50b2tlbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdhdXRoX3Rva2VuJyk7XG4gICAgfVxuICB9XG5cbiAgc2V0VG9rZW4odG9rZW46IHN0cmluZykge1xuICAgIHRoaXMudG9rZW4gPSB0b2tlbjtcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdhdXRoX3Rva2VuJywgdG9rZW4pO1xuICAgIH1cbiAgfVxuXG4gIGNsZWFyVG9rZW4oKSB7XG4gICAgdGhpcy50b2tlbiA9IG51bGw7XG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnYXV0aF90b2tlbicpO1xuICAgIH1cbiAgfVxuXG4gIGdldFRva2VuKCk6IHN0cmluZyB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLnRva2VuO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyByZXF1ZXN0PFQ+KFxuICAgIGVuZHBvaW50OiBzdHJpbmcsXG4gICAgb3B0aW9uczogUmVxdWVzdEluaXQgPSB7fVxuICApOiBQcm9taXNlPEFwaVJlc3BvbnNlPFQ+PiB7XG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5iYXNlVXJsfSR7ZW5kcG9pbnR9YDtcbiAgICBjb25zdCBoZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICB9O1xuXG4gICAgaWYgKHRoaXMudG9rZW4pIHtcbiAgICAgIGhlYWRlcnNbJ0F1dGhvcml6YXRpb24nXSA9IHRoaXMudG9rZW47XG4gICAgfVxuXG4gICAgaWYgKG9wdGlvbnMuaGVhZGVycykge1xuICAgICAgT2JqZWN0LmFzc2lnbihoZWFkZXJzLCBvcHRpb25zLmhlYWRlcnMpO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwge1xuICAgICAgICAuLi5vcHRpb25zLFxuICAgICAgICBoZWFkZXJzLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRhdGE6IHJlc3BvbnNlLm9rID8gZGF0YSA6IHVuZGVmaW5lZCxcbiAgICAgICAgZXJyb3I6IHJlc3BvbnNlLm9rID8gdW5kZWZpbmVkIDogKGRhdGEuZXJyb3IgfHwgZGF0YS5tZXNzYWdlIHx8ICdSZXF1ZXN0IGZhaWxlZCcpLFxuICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0FQSSByZXF1ZXN0IGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdOZXR3b3JrIGVycm9yJyxcbiAgICAgICAgc3RhdHVzOiAwLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvLyBTZXNzaW9ucyBlbmRwb2ludHNcbiAgYXN5bmMgZ2V0U2Vzc2lvbnMoKSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdDx7IHNlc3Npb25zOiBhbnlbXTsgdG90YWw6IG51bWJlciB9PignL3Nlc3Npb25zJyk7XG4gIH1cblxuICBhc3luYyBnZXRBdmFpbGFibGVTZXNzaW9ucygpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0PHsgc2Vzc2lvbnM6IGFueVtdIH0+KCcvc2Vzc2lvbnMvYXZhaWxhYmxlJyk7XG4gIH1cblxuICBhc3luYyBnZXRTZXNzaW9uKHNlc3Npb25JZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdDxhbnk+KGAvc2Vzc2lvbnMvJHtzZXNzaW9uSWR9YCk7XG4gIH1cblxuICBhc3luYyBnZXRTZXNzaW9uU3VibWlzc2lvbnMoc2Vzc2lvbklkOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0PHsgc3VibWlzc2lvbnM6IGFueVtdIH0+KGAvc2Vzc2lvbnMvJHtzZXNzaW9uSWR9L3N1Ym1pc3Npb25zYCk7XG4gIH1cblxuICBhc3luYyBnZXRTZXNzaW9uUmVwb3J0KHNlc3Npb25JZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdDxhbnk+KGAvc2Vzc2lvbnMvJHtzZXNzaW9uSWR9L3JlcG9ydGApO1xuICB9XG5cbiAgYXN5bmMgZ2V0U2Vzc2lvbkV4cG9ydChzZXNzaW9uSWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3Q8c3RyaW5nPihgL3Nlc3Npb25zLyR7c2Vzc2lvbklkfS9leHBvcnRgKTtcbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZVNlc3Npb24oZGF0YToge1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgICBvdmVybGF5X2lkOiBzdHJpbmc7XG4gICAgc3RhcnRfZGF0ZTogc3RyaW5nO1xuICAgIGVuZF9kYXRlOiBzdHJpbmc7XG4gICAgc3RhdHVzPzogc3RyaW5nO1xuICB9KSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdDxhbnk+KCcvc2Vzc2lvbnMnLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgZGVsZXRlU2Vzc2lvbihzZXNzaW9uSWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3Q8YW55PihgL3Nlc3Npb25zLyR7c2Vzc2lvbklkfWAsIHtcbiAgICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyB1cGRhdGVTZXNzaW9uKHNlc3Npb25JZDogc3RyaW5nLCBkYXRhOiB7XG4gICAgbmFtZT86IHN0cmluZztcbiAgICBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgICBzdGF0dXM/OiBzdHJpbmc7XG4gIH0pIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0PGFueT4oYC9zZXNzaW9ucy8ke3Nlc3Npb25JZH1gLCB7XG4gICAgICBtZXRob2Q6ICdQVVQnLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgfSk7XG4gIH1cblxuICAvLyBTdWJtaXNzaW9ucyBlbmRwb2ludHNcbiAgYXN5bmMgZ2V0U3VibWlzc2lvbnMoKSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdDx7IHN1Ym1pc3Npb25zOiBhbnlbXTsgdG90YWw6IG51bWJlciB9PignL3N1Ym1pc3Npb25zJyk7XG4gIH1cblxuICBhc3luYyBnZXRTdWJtaXNzaW9uKHN1Ym1pc3Npb25JZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdDxhbnk+KGAvc3VibWlzc2lvbnMvJHtzdWJtaXNzaW9uSWR9YCk7XG4gIH1cblxuICBhc3luYyBjcmVhdGVTdWJtaXNzaW9uKGRhdGE6IHtcbiAgICBzZXNzaW9uX2lkOiBzdHJpbmc7XG4gICAgb3ZlcmxheV9pZDogc3RyaW5nO1xuICAgIGRvY3VtZW50X25hbWU6IHN0cmluZztcbiAgICBkb2N1bWVudF9jb250ZW50OiBzdHJpbmc7XG4gICAgZmlsZV9zaXplPzogbnVtYmVyO1xuICAgIGlzX3Bhc3RlZF90ZXh0PzogYm9vbGVhbjtcbiAgICBhcHBlbmRpY2VzPzogQXJyYXk8e1xuICAgICAgZmlsZV9uYW1lOiBzdHJpbmc7XG4gICAgICBmaWxlX2NvbnRlbnQ6IHN0cmluZztcbiAgICAgIGZpbGVfc2l6ZTogbnVtYmVyO1xuICAgICAgdXBsb2FkX29yZGVyOiBudW1iZXI7XG4gICAgfT47XG4gIH0pIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0PGFueT4oJy9zdWJtaXNzaW9ucycsIHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBnZXRTdWJtaXNzaW9uRmVlZGJhY2soc3VibWlzc2lvbklkOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0PGFueT4oYC9zdWJtaXNzaW9ucy8ke3N1Ym1pc3Npb25JZH0vZmVlZGJhY2tgKTtcbiAgfVxuXG4gIGFzeW5jIGdldFN1Ym1pc3Npb25Eb3dubG9hZChzdWJtaXNzaW9uSWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3Q8YW55PihgL3N1Ym1pc3Npb25zLyR7c3VibWlzc2lvbklkfS9kb3dubG9hZGApO1xuICB9XG5cbiAgYXN5bmMgZG93bmxvYWRTdWJtaXNzaW9uRmlsZShzdWJtaXNzaW9uSWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3Q8eyBkb3dubG9hZF91cmw6IHN0cmluZzsgZmlsZV9uYW1lOiBzdHJpbmc7IGV4cGlyZXNfaW46IG51bWJlciB9PihgL3N1Ym1pc3Npb25zLyR7c3VibWlzc2lvbklkfS9kb3dubG9hZC1maWxlYCk7XG4gIH1cblxuICBhc3luYyBkb3dubG9hZEFwcGVuZGl4KHN1Ym1pc3Npb25JZDogc3RyaW5nLCBhcHBlbmRpeE9yZGVyOiBudW1iZXIpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0PHsgZG93bmxvYWRfdXJsOiBzdHJpbmc7IGZpbGVfbmFtZTogc3RyaW5nOyBleHBpcmVzX2luOiBudW1iZXIgfT4oYC9zdWJtaXNzaW9ucy8ke3N1Ym1pc3Npb25JZH0vZG93bmxvYWQtYXBwZW5kaXgvJHthcHBlbmRpeE9yZGVyfWApO1xuICB9XG5cbiAgLy8gQW5zd2VycyBlbmRwb2ludHNcbiAgYXN5bmMgZ2V0QW5zd2VycyhzdWJtaXNzaW9uSWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3Q8eyBxdWVzdGlvbnM6IGFueVtdOyB0b3RhbDogbnVtYmVyIH0+KGAvc3VibWlzc2lvbnMvJHtzdWJtaXNzaW9uSWR9L2Fuc3dlcnNgKTtcbiAgfVxuXG4gIGFzeW5jIHN1Ym1pdEFuc3dlcihzdWJtaXNzaW9uSWQ6IHN0cmluZywgZGF0YToge1xuICAgIHF1ZXN0aW9uX2lkOiBzdHJpbmc7XG4gICAgYW5zd2VyX3RleHQ6IHN0cmluZztcbiAgfSkge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3Q8YW55PihgL3N1Ym1pc3Npb25zLyR7c3VibWlzc2lvbklkfS9hbnN3ZXJzYCwge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShkYXRhKSxcbiAgICB9KTtcbiAgfVxuXG4gIC8vIE9yZ2FuaXphdGlvbnMgZW5kcG9pbnRzXG4gIGFzeW5jIGdldE9yZ2FuaXphdGlvbnMoKSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdDx7IG9yZ2FuaXphdGlvbnM6IGFueVtdOyB0b3RhbDogbnVtYmVyIH0+KCcvb3JnYW5pemF0aW9ucycpO1xuICB9XG5cbiAgLy8gT3ZlcmxheXMgZW5kcG9pbnRzXG4gIGFzeW5jIGdldE92ZXJsYXlzKCkge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3Q8eyBvdmVybGF5czogYW55W107IHRvdGFsOiBudW1iZXIgfT4oJy9vdmVybGF5cycpO1xuICB9XG5cbiAgYXN5bmMgZ2V0T3ZlcmxheShvdmVybGF5SWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3Q8YW55PihgL292ZXJsYXlzLyR7b3ZlcmxheUlkfWApO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlT3ZlcmxheShkYXRhOiB7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAgIGRvY3VtZW50X3R5cGU/OiBzdHJpbmcgfCBudWxsO1xuICAgIGRvY3VtZW50X3B1cnBvc2U/OiBzdHJpbmcgfCBudWxsO1xuICAgIHdoZW5fdXNlZD86IHN0cmluZyB8IG51bGw7XG4gICAgcHJvY2Vzc19jb250ZXh0Pzogc3RyaW5nIHwgbnVsbDtcbiAgICB0YXJnZXRfYXVkaWVuY2U/OiBzdHJpbmcgfCBudWxsO1xuICAgIGlzX2FjdGl2ZT86IGJvb2xlYW47XG4gICAgY3JpdGVyaWE/OiBhbnlbXTtcbiAgfSkge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3Q8YW55PignL292ZXJsYXlzJywge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShkYXRhKSxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZU92ZXJsYXkob3ZlcmxheUlkOiBzdHJpbmcsIGRhdGE6IHtcbiAgICBuYW1lPzogc3RyaW5nO1xuICAgIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAgIGRvY3VtZW50X3R5cGU/OiBzdHJpbmcgfCBudWxsO1xuICAgIGRvY3VtZW50X3B1cnBvc2U/OiBzdHJpbmcgfCBudWxsO1xuICAgIHdoZW5fdXNlZD86IHN0cmluZyB8IG51bGw7XG4gICAgcHJvY2Vzc19jb250ZXh0Pzogc3RyaW5nIHwgbnVsbDtcbiAgICB0YXJnZXRfYXVkaWVuY2U/OiBzdHJpbmcgfCBudWxsO1xuICAgIGlzX2FjdGl2ZT86IGJvb2xlYW47XG4gICAgY3JpdGVyaWE/OiBhbnlbXTtcbiAgfSkge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3Q8YW55PihgL292ZXJsYXlzLyR7b3ZlcmxheUlkfWAsIHtcbiAgICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShkYXRhKSxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZU92ZXJsYXkob3ZlcmxheUlkOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0PGFueT4oYC9vdmVybGF5cy8ke292ZXJsYXlJZH1gLCB7XG4gICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgIH0pO1xuICB9XG5cbiAgLy8gTExNIENvbmZpZyBlbmRwb2ludHMgKGFkbWluIG9ubHkpXG4gIGFzeW5jIGdldExMTUNvbmZpZ3MoKSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdDx7IGNvbmZpZ3M6IGFueVtdOyB0b3RhbDogbnVtYmVyIH0+KCcvbGxtLWNvbmZpZycpO1xuICB9XG5cbiAgYXN5bmMgZ2V0TExNQ29uZmlnKGFnZW50TmFtZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdDxhbnk+KGAvbGxtLWNvbmZpZy8ke2FnZW50TmFtZX1gKTtcbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZUxMTUNvbmZpZyhhZ2VudE5hbWU6IHN0cmluZywgZGF0YTogYW55KSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdDxhbnk+KGAvbGxtLWNvbmZpZy8ke2FnZW50TmFtZX1gLCB7XG4gICAgICBtZXRob2Q6ICdQVVQnLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IGFwaUNsaWVudCA9IG5ldyBBcGlDbGllbnQoQVBJX0JBU0VfVVJMKTtcbmV4cG9ydCBkZWZhdWx0IGFwaUNsaWVudDtcbiJdfQ==