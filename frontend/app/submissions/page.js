"use client";
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = SubmissionsPage;
const react_1 = require("react");
const navigation_1 = require("next/navigation");
const card_1 = require("@/components/ui/card");
const button_1 = require("@/components/ui/button");
const badge_1 = require("@/components/ui/badge");
const alert_1 = require("@/components/ui/alert");
const lucide_react_1 = require("lucide-react");
const api_client_1 = require("@/lib/api-client");
const auth_1 = require("@/lib/auth");
function SubmissionsPage() {
    const router = (0, navigation_1.useRouter)();
    const [submissions, setSubmissions] = (0, react_1.useState)([]);
    const [isLoading, setIsLoading] = (0, react_1.useState)(true);
    const [error, setError] = (0, react_1.useState)(null);
    const [user, setUser] = (0, react_1.useState)(null);
    (0, react_1.useEffect)(() => {
        const currentUser = (0, auth_1.getCurrentUser)();
        if (!currentUser) {
            router.push("/login");
            return;
        }
        setUser(currentUser);
        loadSubmissions();
    }, [router]);
    const loadSubmissions = async () => {
        setIsLoading(true);
        setError(null);
        try {
            const result = await api_client_1.apiClient.getSubmissions();
            if (result.error) {
                setError(result.error);
            }
            else if (result.data) {
                setSubmissions(result.data.submissions || []);
            }
        }
        catch (err) {
            setError("Failed to load submissions");
            console.error(err);
        }
        finally {
            setIsLoading(false);
        }
    };
    const getStatusIcon = (status) => {
        switch (status) {
            case "completed":
                return <lucide_react_1.CheckCircle2 className="h-5 w-5 text-green-600"/>;
            case "processing":
                return <lucide_react_1.Clock className="h-5 w-5 text-blue-600"/>;
            case "failed":
                return <lucide_react_1.XCircle className="h-5 w-5 text-red-600"/>;
            default:
                return <lucide_react_1.AlertCircle className="h-5 w-5 text-slate-600"/>;
        }
    };
    const getStatusColor = (status) => {
        switch (status) {
            case "completed":
                return "default";
            case "processing":
                return "secondary";
            case "failed":
                return "destructive";
            default:
                return "outline";
        }
    };
    const getScoreColor = (score) => {
        if (!score)
            return "text-slate-600";
        if (score >= 80)
            return "text-green-600";
        if (score >= 60)
            return "text-yellow-600";
        return "text-red-600";
    };
    if (isLoading) {
        return (<div className="min-h-screen bg-gradient-to-b from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 flex items-center justify-center">
        <div className="text-center">
          <lucide_react_1.Loader2 className="h-8 w-8 animate-spin mx-auto mb-4 text-slate-600"/>
          <p className="text-slate-600 dark:text-slate-400">Loading submissions...</p>
        </div>
      </div>);
    }
    return (<div className="min-h-screen bg-gradient-to-b from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800">
      <div className="container mx-auto p-6 max-w-7xl">
        {/* Header */}
        <div className="mb-8">
          <button_1.Button variant="ghost" onClick={() => router.push("/dashboard")} className="mb-4">
            <lucide_react_1.ArrowLeft className="mr-2 h-4 w-4"/>
            Back to Dashboard
          </button_1.Button>

          <div className="flex items-center justify-between">
            <div>
              <h1 className="text-4xl font-bold text-slate-900 dark:text-slate-50 mb-2">
                My Analyses
              </h1>
              <p className="text-slate-600 dark:text-slate-400">
                View all your document analyses and their status
              </p>
            </div>
            <button_1.Button onClick={loadSubmissions} variant="outline">
              Refresh
            </button_1.Button>
          </div>
        </div>

        {error && (<alert_1.Alert variant="destructive" className="mb-6">
            <alert_1.AlertDescription>{error}</alert_1.AlertDescription>
          </alert_1.Alert>)}

        {/* Submissions List */}
        <card_1.Card>
          <card_1.CardHeader>
            <card_1.CardTitle className="flex items-center gap-2">
              <lucide_react_1.FileText className="h-5 w-5"/>
              All Analyses ({submissions.length})
            </card_1.CardTitle>
            <card_1.CardDescription>
              Click on an analysis to view detailed evaluation and feedback
            </card_1.CardDescription>
          </card_1.CardHeader>
          <card_1.CardContent>
            {submissions.length === 0 ? (<div className="text-center py-12">
                <lucide_react_1.FileText className="h-16 w-16 mx-auto mb-4 text-slate-400"/>
                <h3 className="text-lg font-semibold text-slate-900 dark:text-slate-50 mb-2">
                  No analyses yet
                </h3>
                <p className="text-slate-600 dark:text-slate-400 mb-4">
                  Upload a document to an analysis session to get started
                </p>
                <button_1.Button onClick={() => router.push("/dashboard")}>
                  Go to Dashboard
                </button_1.Button>
              </div>) : (<div className="space-y-4">
                {submissions.map((submission) => (<card_1.Card key={submission.submission_id} className="cursor-pointer hover:border-blue-500 transition-colors" onClick={() => router.push(`/submission/${submission.submission_id}`)}>
                    <card_1.CardContent className="pt-6">
                      <div className="flex items-start justify-between">
                        <div className="flex-1">
                          <div className="flex items-center gap-3 mb-2">
                            {getStatusIcon(submission.status)}
                            <div>
                              <h3 className="font-semibold text-lg text-slate-900 dark:text-slate-50">
                                {submission.document_name}
                              </h3>
                              <p className="text-sm text-slate-600 dark:text-slate-400">
                                Session: {submission.session_name}
                              </p>
                            </div>
                          </div>

                          <div className="flex items-center gap-4 mt-4">
                            <badge_1.Badge variant={getStatusColor(submission.status)}>
                              {submission.status}
                            </badge_1.Badge>

                            {submission.overall_score !== undefined && (<div className="flex items-center gap-2">
                                <span className="text-sm text-slate-600 dark:text-slate-400">
                                  Score:
                                </span>
                                <span className={`font-bold text-lg ${getScoreColor(submission.overall_score)}`}>
                                  {submission.overall_score.toFixed(1)}%
                                </span>
                              </div>)}

                            <span className="text-sm text-slate-500 dark:text-slate-500 ml-auto">
                              {new Date(submission.submitted_at).toLocaleString()}
                            </span>
                          </div>
                        </div>
                      </div>
                    </card_1.CardContent>
                  </card_1.Card>))}
              </div>)}
          </card_1.CardContent>
        </card_1.Card>
      </div>
    </div>);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInBhZ2UudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQzs7O0FBc0JiLGtDQWdNQztBQXBORCxpQ0FBNEM7QUFDNUMsZ0RBQTRDO0FBQzVDLCtDQUFpRztBQUNqRyxtREFBZ0Q7QUFDaEQsaURBQThDO0FBQzlDLGlEQUFnRTtBQUNoRSwrQ0FBdUc7QUFDdkcsaURBQTZDO0FBQzdDLHFDQUE0QztBQVk1QyxTQUF3QixlQUFlO0lBQ3JDLE1BQU0sTUFBTSxHQUFHLElBQUEsc0JBQVMsR0FBRSxDQUFDO0lBQzNCLE1BQU0sQ0FBQyxXQUFXLEVBQUUsY0FBYyxDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFlLEVBQUUsQ0FBQyxDQUFDO0lBQ2pFLE1BQU0sQ0FBQyxTQUFTLEVBQUUsWUFBWSxDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2pELE1BQU0sQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFnQixJQUFJLENBQUMsQ0FBQztJQUN4RCxNQUFNLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBTSxJQUFJLENBQUMsQ0FBQztJQUU1QyxJQUFBLGlCQUFTLEVBQUMsR0FBRyxFQUFFO1FBQ2IsTUFBTSxXQUFXLEdBQUcsSUFBQSxxQkFBYyxHQUFFLENBQUM7UUFDckMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ2pCLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDdEIsT0FBTztRQUNULENBQUM7UUFDRCxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDckIsZUFBZSxFQUFFLENBQUM7SUFDcEIsQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUViLE1BQU0sZUFBZSxHQUFHLEtBQUssSUFBSSxFQUFFO1FBQ2pDLFlBQVksQ0FBQyxJQUFJ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QUFJLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxDQUFDLGNBQWMsRUFBRSxDQUNyRDs0QkFBQSxFQUFFLElBQUksQ0FDUjswQkFBQSxFQUFFLEdBQUcsQ0FDUDt3QkFBQSxFQUFFLEdBQUcsQ0FDUDtzQkFBQSxFQUFFLEdBQUcsQ0FDUDtvQkFBQSxFQUFFLGtCQUFXLENBQ2Y7a0JBQUEsRUFBRSxXQUFJLENBQUMsQ0FDUixDQUFDLENBQ0o7Y0FBQSxFQUFFLEdBQUcsQ0FBQyxDQUNQLENBQ0g7VUFBQSxFQUFFLGtCQUFXLENBQ2Y7UUFBQSxFQUFFLFdBQUksQ0FDUjtNQUFBLEVBQUUsR0FBRyxDQUNQO0lBQUEsRUFBRSxHQUFHLENBQUMsQ0FDUCxDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIGNsaWVudFwiO1xuXG5pbXBvcnQgeyB1c2VFZmZlY3QsIHVzZVN0YXRlIH0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgeyB1c2VSb3V0ZXIgfSBmcm9tIFwibmV4dC9uYXZpZ2F0aW9uXCI7XG5pbXBvcnQgeyBDYXJkLCBDYXJkQ29udGVudCwgQ2FyZERlc2NyaXB0aW9uLCBDYXJkSGVhZGVyLCBDYXJkVGl0bGUgfSBmcm9tIFwiQC9jb21wb25lbnRzL3VpL2NhcmRcIjtcbmltcG9ydCB7IEJ1dHRvbiB9IGZyb20gXCJAL2NvbXBvbmVudHMvdWkvYnV0dG9uXCI7XG5pbXBvcnQgeyBCYWRnZSB9IGZyb20gXCJAL2NvbXBvbmVudHMvdWkvYmFkZ2VcIjtcbmltcG9ydCB7IEFsZXJ0LCBBbGVydERlc2NyaXB0aW9uIH0gZnJvbSBcIkAvY29tcG9uZW50cy91aS9hbGVydFwiO1xuaW1wb3J0IHsgTG9hZGVyMiwgQXJyb3dMZWZ0LCBGaWxlVGV4dCwgQ2xvY2ssIENoZWNrQ2lyY2xlMiwgWENpcmNsZSwgQWxlcnRDaXJjbGUgfSBmcm9tIFwibHVjaWRlLXJlYWN0XCI7XG5pbXBvcnQgeyBhcGlDbGllbnQgfSBmcm9tIFwiQC9saWIvYXBpLWNsaWVudFwiO1xuaW1wb3J0IHsgZ2V0Q3VycmVudFVzZXIgfSBmcm9tIFwiQC9saWIvYXV0aFwiO1xuXG5pbnRlcmZhY2UgU3VibWlzc2lvbiB7XG4gIHN1Ym1pc3Npb25faWQ6IHN0cmluZztcbiAgc2Vzc2lvbl9uYW1lOiBzdHJpbmc7XG4gIGRvY3VtZW50X25hbWU6IHN0cmluZztcbiAgc3RhdHVzOiBzdHJpbmc7XG4gIHN1Ym1pdHRlZF9hdDogc3RyaW5nO1xuICBvdmVyYWxsX3Njb3JlPzogbnVtYmVyO1xuICBzZXNzaW9uX2lkOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIFN1Ym1pc3Npb25zUGFnZSgpIHtcbiAgY29uc3Qgcm91dGVyID0gdXNlUm91dGVyKCk7XG4gIGNvbnN0IFtzdWJtaXNzaW9ucywgc2V0U3VibWlzc2lvbnNdID0gdXNlU3RhdGU8U3VibWlzc2lvbltdPihbXSk7XG4gIGNvbnN0IFtpc0xvYWRpbmcsIHNldElzTG9hZGluZ10gPSB1c2VTdGF0ZSh0cnVlKTtcbiAgY29uc3QgW2Vycm9yLCBzZXRFcnJvcl0gPSB1c2VTdGF0ZTxzdHJpbmcgfCBudWxsPihudWxsKTtcbiAgY29uc3QgW3VzZXIsIHNldFVzZXJdID0gdXNlU3RhdGU8YW55PihudWxsKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gZ2V0Q3VycmVudFVzZXIoKTtcbiAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICByb3V0ZXIucHVzaChcIi9sb2dpblwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc2V0VXNlcihjdXJyZW50VXNlcik7XG4gICAgbG9hZFN1Ym1pc3Npb25zKCk7XG4gIH0sIFtyb3V0ZXJdKTtcblxuICBjb25zdCBsb2FkU3VibWlzc2lvbnMgPSBhc3luYyAoKSA9PiB7XG4gICAgc2V0SXNMb2FkaW5nKHRydWUpO1xuICAgIHNldEVycm9yKG51bGwpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFwaUNsaWVudC5nZXRTdWJtaXNzaW9ucygpO1xuXG4gICAgICBpZiAocmVzdWx0LmVycm9yKSB7XG4gICAgICAgIHNldEVycm9yKHJlc3VsdC5lcnJvcik7XG4gICAgICB9IGVsc2UgaWYgKHJlc3VsdC5kYXRhKSB7XG4gICAgICAgIHNldFN1Ym1pc3Npb25zKHJlc3VsdC5kYXRhLnN1Ym1pc3Npb25zIHx8IFtdKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHNldEVycm9yKFwiRmFpbGVkIHRvIGxvYWQgc3VibWlzc2lvbnNcIik7XG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHNldElzTG9hZGluZyhmYWxzZSk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGdldFN0YXR1c0ljb24gPSAoc3RhdHVzOiBzdHJpbmcpID0+IHtcbiAgICBzd2l0Y2ggKHN0YXR1cykge1xuICAgICAgY2FzZSBcImNvbXBsZXRlZFwiOlxuICAgICAgICByZXR1cm4gPENoZWNrQ2lyY2xlMiBjbGFzc05hbWU9XCJoLTUgdy01IHRleHQtZ3JlZW4tNjAwXCIgLz47XG4gICAgICBjYXNlIFwicHJvY2Vzc2luZ1wiOlxuICAgICAgICByZXR1cm4gPENsb2NrIGNsYXNzTmFtZT1cImgtNSB3LTUgdGV4dC1ibHVlLTYwMFwiIC8+O1xuICAgICAgY2FzZSBcImZhaWxlZFwiOlxuICAgICAgICByZXR1cm4gPFhDaXJjbGUgY2xhc3NOYW1lPVwiaC01IHctNSB0ZXh0LXJlZC02MDBcIiAvPjtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiA8QWxlcnRDaXJjbGUgY2xhc3NOYW1lPVwiaC01IHctNSB0ZXh0LXNsYXRlLTYwMFwiIC8+O1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBnZXRTdGF0dXNDb2xvciA9IChzdGF0dXM6IHN0cmluZykgPT4ge1xuICAgIHN3aXRjaCAoc3RhdHVzKSB7XG4gICAgICBjYXNlIFwiY29tcGxldGVkXCI6XG4gICAgICAgIHJldHVybiBcImRlZmF1bHRcIjtcbiAgICAgIGNhc2UgXCJwcm9jZXNzaW5nXCI6XG4gICAgICAgIHJldHVybiBcInNlY29uZGFyeVwiO1xuICAgICAgY2FzZSBcImZhaWxlZFwiOlxuICAgICAgICByZXR1cm4gXCJkZXN0cnVjdGl2ZVwiO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIFwib3V0bGluZVwiO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBnZXRTY29yZUNvbG9yID0gKHNjb3JlPzogbnVtYmVyKSA9PiB7XG4gICAgaWYgKCFzY29yZSkgcmV0dXJuIFwidGV4dC1zbGF0ZS02MDBcIjtcbiAgICBpZiAoc2NvcmUgPj0gODApIHJldHVybiBcInRleHQtZ3JlZW4tNjAwXCI7XG4gICAgaWYgKHNjb3JlID49IDYwKSByZXR1cm4gXCJ0ZXh0LXllbGxvdy02MDBcIjtcbiAgICByZXR1cm4gXCJ0ZXh0LXJlZC02MDBcIjtcbiAgfTtcblxuICBpZiAoaXNMb2FkaW5nKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwibWluLWgtc2NyZWVuIGJnLWdyYWRpZW50LXRvLWIgZnJvbS1zbGF0ZS01MCB0by1zbGF0ZS0xMDAgZGFyazpmcm9tLXNsYXRlLTkwMCBkYXJrOnRvLXNsYXRlLTgwMCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlclwiPlxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInRleHQtY2VudGVyXCI+XG4gICAgICAgICAgPExvYWRlcjIgY2xhc3NOYW1lPVwiaC04IHctOCBhbmltYXRlLXNwaW4gbXgtYXV0byBtYi00IHRleHQtc2xhdGUtNjAwXCIgLz5cbiAgICAgICAgICA8cCBjbGFzc05hbWU9XCJ0ZXh0LXNsYXRlLTYwMCBkYXJrOnRleHQtc2xhdGUtNDAwXCI+TG9hZGluZyBzdWJtaXNzaW9ucy4uLjwvcD5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2IGNsYXNzTmFtZT1cIm1pbi1oLXNjcmVlbiBiZy1ncmFkaWVudC10by1iIGZyb20tc2xhdGUtNTAgdG8tc2xhdGUtMTAwIGRhcms6ZnJvbS1zbGF0ZS05MDAgZGFyazp0by1zbGF0ZS04MDBcIj5cbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwiY29udGFpbmVyIG14LWF1dG8gcC02IG1heC13LTd4bFwiPlxuICAgICAgICB7LyogSGVhZGVyICovfVxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm1iLThcIj5cbiAgICAgICAgICA8QnV0dG9uIHZhcmlhbnQ9XCJnaG9zdFwiIG9uQ2xpY2s9eygpID0+IHJvdXRlci5wdXNoKFwiL2Rhc2hib2FyZFwiKX0gY2xhc3NOYW1lPVwibWItNFwiPlxuICAgICAgICAgICAgPEFycm93TGVmdCBjbGFzc05hbWU9XCJtci0yIGgtNCB3LTRcIiAvPlxuICAgICAgICAgICAgQmFjayB0byBEYXNoYm9hcmRcbiAgICAgICAgICA8L0J1dHRvbj5cblxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuXCI+XG4gICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICA8aDEgY2xhc3NOYW1lPVwidGV4dC00eGwgZm9udC1ib2xkIHRleHQtc2xhdGUtOTAwIGRhcms6dGV4dC1zbGF0ZS01MCBtYi0yXCI+XG4gICAgICAgICAgICAgICAgTXkgQW5hbHlzZXNcbiAgICAgICAgICAgICAgPC9oMT5cbiAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPVwidGV4dC1zbGF0ZS02MDAgZGFyazp0ZXh0LXNsYXRlLTQwMFwiPlxuICAgICAgICAgICAgICAgIFZpZXcgYWxsIHlvdXIgZG9jdW1lbnQgYW5hbHlzZXMgYW5kIHRoZWlyIHN0YXR1c1xuICAgICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxCdXR0b24gb25DbGljaz17bG9hZFN1Ym1pc3Npb25zfSB2YXJpYW50PVwib3V0bGluZVwiPlxuICAgICAgICAgICAgICBSZWZyZXNoXG4gICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAge2Vycm9yICYmIChcbiAgICAgICAgICA8QWxlcnQgdmFyaWFudD1cImRlc3RydWN0aXZlXCIgY2xhc3NOYW1lPVwibWItNlwiPlxuICAgICAgICAgICAgPEFsZXJ0RGVzY3JpcHRpb24+e2Vycm9yfTwvQWxlcnREZXNjcmlwdGlvbj5cbiAgICAgICAgICA8L0FsZXJ0PlxuICAgICAgICApfVxuXG4gICAgICAgIHsvKiBTdWJtaXNzaW9ucyBMaXN0ICovfVxuICAgICAgICA8Q2FyZD5cbiAgICAgICAgICA8Q2FyZEhlYWRlcj5cbiAgICAgICAgICAgIDxDYXJkVGl0bGUgY2xhc3NOYW1lPVwiZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTJcIj5cbiAgICAgICAgICAgICAgPEZpbGVUZXh0IGNsYXNzTmFtZT1cImgtNSB3LTVcIiAvPlxuICAgICAgICAgICAgICBBbGwgQW5hbHlzZXMgKHtzdWJtaXNzaW9ucy5sZW5ndGh9KVxuICAgICAgICAgICAgPC9DYXJkVGl0bGU+XG4gICAgICAgICAgICA8Q2FyZERlc2NyaXB0aW9uPlxuICAgICAgICAgICAgICBDbGljayBvbiBhbiBhbmFseXNpcyB0byB2aWV3IGRldGFpbGVkIGV2YWx1YXRpb24gYW5kIGZlZWRiYWNrXG4gICAgICAgICAgICA8L0NhcmREZXNjcmlwdGlvbj5cbiAgICAgICAgICA8L0NhcmRIZWFkZXI+XG4gICAgICAgICAgPENhcmRDb250ZW50PlxuICAgICAgICAgICAge3N1Ym1pc3Npb25zLmxlbmd0aCA9PT0gMCA/IChcbiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ0ZXh0LWNlbnRlciBweS0xMlwiPlxuICAgICAgICAgICAgICAgIDxGaWxlVGV4dCBjbGFzc05hbWU9XCJoLTE2IHctMTYgbXgtYXV0byBtYi00IHRleHQtc2xhdGUtNDAwXCIgLz5cbiAgICAgICAgICAgICAgICA8aDMgY2xhc3NOYW1lPVwidGV4dC1sZyBmb250LXNlbWlib2xkIHRleHQtc2xhdGUtOTAwIGRhcms6dGV4dC1zbGF0ZS01MCBtYi0yXCI+XG4gICAgICAgICAgICAgICAgICBObyBhbmFseXNlcyB5ZXRcbiAgICAgICAgICAgICAgICA8L2gzPlxuICAgICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT1cInRleHQtc2xhdGUtNjAwIGRhcms6dGV4dC1zbGF0ZS00MDAgbWItNFwiPlxuICAgICAgICAgICAgICAgICAgVXBsb2FkIGEgZG9jdW1lbnQgdG8gYW4gYW5hbHlzaXMgc2Vzc2lvbiB0byBnZXQgc3RhcnRlZFxuICAgICAgICAgICAgICAgIDwvcD5cbiAgICAgICAgICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9eygpID0+IHJvdXRlci5wdXNoKFwiL2Rhc2hib2FyZFwiKX0+XG4gICAgICAgICAgICAgICAgICBHbyB0byBEYXNoYm9hcmRcbiAgICAgICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICApIDogKFxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInNwYWNlLXktNFwiPlxuICAgICAgICAgICAgICAgIHtzdWJtaXNzaW9ucy5tYXAoKHN1Ym1pc3Npb24pID0+IChcbiAgICAgICAgICAgICAgICAgIDxDYXJkXG4gICAgICAgICAgICAgICAgICAgIGtleT17c3VibWlzc2lvbi5zdWJtaXNzaW9uX2lkfVxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJjdXJzb3ItcG9pbnRlciBob3Zlcjpib3JkZXItYmx1ZS01MDAgdHJhbnNpdGlvbi1jb2xvcnNcIlxuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiByb3V0ZXIucHVzaChgL3N1Ym1pc3Npb24vJHtzdWJtaXNzaW9uLnN1Ym1pc3Npb25faWR9YCl9XG4gICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgIDxDYXJkQ29udGVudCBjbGFzc05hbWU9XCJwdC02XCI+XG4gICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGl0ZW1zLXN0YXJ0IGp1c3RpZnktYmV0d2VlblwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4LTFcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMyBtYi0yXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge2dldFN0YXR1c0ljb24oc3VibWlzc2lvbi5zdGF0dXMpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDMgY2xhc3NOYW1lPVwiZm9udC1zZW1pYm9sZCB0ZXh0LWxnIHRleHQtc2xhdGUtOTAwIGRhcms6dGV4dC1zbGF0ZS01MFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c3VibWlzc2lvbi5kb2N1bWVudF9uYW1lfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9oMz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT1cInRleHQtc20gdGV4dC1zbGF0ZS02MDAgZGFyazp0ZXh0LXNsYXRlLTQwMFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZXNzaW9uOiB7c3VibWlzc2lvbi5zZXNzaW9uX25hbWV9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTQgbXQtNFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxCYWRnZSB2YXJpYW50PXtnZXRTdGF0dXNDb2xvcihzdWJtaXNzaW9uLnN0YXR1cyl9PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3N1Ym1pc3Npb24uc3RhdHVzfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvQmFkZ2U+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c3VibWlzc2lvbi5vdmVyYWxsX3Njb3JlICE9PSB1bmRlZmluZWQgJiYgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMlwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJ0ZXh0LXNtIHRleHQtc2xhdGUtNjAwIGRhcms6dGV4dC1zbGF0ZS00MDBcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTY29yZTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9e2Bmb250LWJvbGQgdGV4dC1sZyAke2dldFNjb3JlQ29sb3Ioc3VibWlzc2lvbi5vdmVyYWxsX3Njb3JlKX1gfT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c3VibWlzc2lvbi5vdmVyYWxsX3Njb3JlLnRvRml4ZWQoMSl9JVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwidGV4dC1zbSB0ZXh0LXNsYXRlLTUwMCBkYXJrOnRleHQtc2xhdGUtNTAwIG1sLWF1dG9cIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtuZXcgRGF0ZShzdWJtaXNzaW9uLnN1Ym1pdHRlZF9hdCkudG9Mb2NhbGVTdHJpbmcoKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDwvQ2FyZENvbnRlbnQ+XG4gICAgICAgICAgICAgICAgICA8L0NhcmQ+XG4gICAgICAgICAgICAgICAgKSl9XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA8L0NhcmRDb250ZW50PlxuICAgICAgICA8L0NhcmQ+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgKTtcbn1cbiJdfQ==